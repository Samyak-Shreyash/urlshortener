# application.properties - SPRING BOOT APPLICATION SETTINGS
spring.application.name=URLShortener
server.port=${SERVER_PORT}

db.master.port=${MASTER_PORT}
db.slave1.port=${SLAVE1_PORT}
db.slave2.port=${SLAVE2_PORT}

# Database Configuration
spring.datasource.write.url=${SPRING_DATASOURCE_WRITE_URL:jdbc:mysql://mysql_master:${db.master.port}/url_shortener}
spring.datasource.read.url=${SPRING_DATASOURCE_READ_URL:jdbc:mysql:loadbalance://mysql_slave1:${db.slave1.port},mysql_slave2:${db.slave2.port}/url_shortener}

spring.datasource.write.username=${MYSQL_USER}
spring.datasource.write.password=${MYSQL_USER_PASSWORD}
spring.datasource.read.username=${MYSQL_USER}
spring.datasource.read.password=${MYSQL_USER_PASSWORD}

spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
# HikariCP Optimization for 24-core/32-thread system
spring.datasource.hikari.maximum-pool-size=15
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=2000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000   
spring.datasource.hikari.pool-name=URLShortenerPool
# Master write pool   (more conservative)
spring.datasource.write.hikari.maximum-pool-size=20
spring.datasource.write.hikari.minimum-idle=5
# Slave read pool   (can be larger)
spring.datasource.read.hikari.maximum-pool-size=30
spring.datasource.read.hikari.minimum-idle=10
# Additional optimizations for high-performance systems
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.connection-test-query=SELECT 1

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.format_sql=true

# Structured logging for parsing
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%X{correlationId}] [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
# Reduce noise but keep important info
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=WARN
logging.file.name=logs/myapp.log
# Application logging
logging.level.com.urlshortener=INFO
# Enable Hikari pool logging for connection issues
logging.level.com.zaxxer.hikari.pool=WARN

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,env,beans
management.endpoint.health.show-details=always
management.endpoint.health.show<｜begin▁of▁sentence｜>components=always

# Custom health check details
management.health.db.enabled=true
management.health.diskspace.enabled=true

# Customize health check groups
management.endpoint.health.group.custom.include=db,diskSpace,ping
